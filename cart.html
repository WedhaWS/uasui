<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WSKICKS - Keranjang</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    /* Reset & Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f7f7f7;
      color: #333;
      line-height: 1.6;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* Header */
    .header {
      background: #fdfdfd;
      color: rgb(0, 0, 0);
      padding: 1rem 2rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .nav a {
      margin-left: 1.5rem;
      font-weight: 500;
      color: #000000;
      transition: color 0.3s ease;
    }

    .nav a:hover,
    .nav a.active {
      color: #ff4747;
    }

    /* Tab Navigation */
    .tab-nav {
      max-width: 900px;
      margin: 2rem auto 0;
      display: flex;
      border-bottom: 2px solid #eee;
      background: white;
      border-radius: 10px 10px 0 0;
    }

    .tab-btn {
      flex: 1;
      padding: 1rem;
      background: none;
      border: none;
      cursor: pointer;
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }

    .tab-btn.active {
      background: #f8f9fa;
      border-bottom-color: #ff4747;
      color: #ff4747;
      font-weight: 600;
    }

    .tab-btn:hover {
      background: #f8f9fa;
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Main Cart */
    .cart-main {
      max-width: 900px;
      margin: 0 auto 2rem;
      padding: 2rem;
      background: white;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .cart-main h1 {
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      font-weight: 600;
    }

    .cart-items .cart-item {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      border: 1px solid #eee;
      border-radius: 8px;
      background: #fafafa;
    }

    .cart-item img {
      width: 120px;
      height: auto;
      border-radius: 8px;
      margin-right: 20px;
    }

    .item-details {
      flex: 1;
    }

    .item-details h3 {
      margin-bottom: 0.3rem;
      font-size: 1.1rem;
      color: #111;
    }

    .item-details p {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 0.2rem;
    }

    .remove-btn {
      background: #ff4d4d;
      border: none;
      color: white;
      padding: 8px 14px;
      font-size: 0.9rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .remove-btn:hover {
      background: #e60000;
    }

    .payment-section {
      margin: 2rem 0;
      padding: 1.5rem;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .payment-section h2 {
      margin-bottom: 1rem;
      color: #333;
    }

    .payment-section select {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      background: white;
    }

    .payment-detail {
      margin-top: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 8px;
    }

    .payment-detail img.qris-img {
      width: 180px;
      height: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin: 1rem auto;
      display: block;
    }

    .wallet-logos, .bank-logos {
      display: grid;
      gap: 12px;
      margin-top: 1rem;
    }

    .wallet, .bank {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.95rem;
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .wallet:hover, .bank:hover {
      background-color: #f5f5f5;
      border-color: #007bff;
    }

    .wallet.selected-option, .bank.selected-option {
      border-color: #007bff;
      background-color: #e6f0ff;
    }

    .wallet img, .bank img {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      object-fit: contain;
    }

    .cart-summary {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .cart-summary h2 {
      margin-bottom: 1rem;
      text-align: center;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 16px;
    }

    .summary-row.total {
      font-weight: bold;
      border-top: 2px solid #333;
      padding-top: 10px;
      font-size: 18px;
      margin-top: 15px;
    }

    .checkout-btn {
      width: 100%;
      margin-top: 1rem;
      padding: 12px;
      font-size: 1.1rem;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .checkout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
    }

    .checkout-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #qr-section {
      margin-top: 20px;
      padding: 20px;
      background: white;
      border-radius: 8px;
      text-align: center;
      border: 2px dashed #27ae60;
    }

    #qr-section h3 {
      color: #27ae60;
      margin-bottom: 15px;
    }

    #qr-image {
      width: 200px;
      height: 200px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .empty {
      font-style: italic;
      text-align: center;
      color: #888;
      padding: 40px 0;
    }

    /* Payment Status */
    .payment-status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
    }

    .payment-status.pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .payment-status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .payment-status.failed {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* Transaction History */
    .history-container {
      max-width: 900px;
      margin: 0 auto 2rem;
      background: white;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .history-main {
      padding: 2rem;
    }

    .history-main h1 {
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      font-weight: 600;
    }

    .transaction-item {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .transaction-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #dee2e6;
    }

    .transaction-id {
      font-weight: 600;
      color: #333;
    }

    .transaction-date {
      color: #666;
      font-size: 0.9rem;
    }

    .transaction-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-failed {
      background: #f8d7da;
      color: #721c24;
    }

    .transaction-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .transaction-info {
      font-size: 0.9rem;
    }

    .transaction-info strong {
      color: #333;
    }

    .transaction-items {
      margin-top: 1rem;
    }

    .transaction-items h4 {
      margin-bottom: 0.5rem;
      color: #333;
    }

    .transaction-item-list {
      font-size: 0.9rem;
      color: #666;
    }

    @media (max-width: 768px) {
      .cart-main, .history-main {
        margin: 1rem;
        padding: 1rem;
      }

      .cart-item {
        flex-direction: column;
        text-align: center;
      }

      .cart-item img {
        margin: 0 0 1rem 0;
      }

      .transaction-details {
        grid-template-columns: 1fr;
      }

      .transaction-header {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo">WSKICKS</div>
      <nav class="nav">
        <a href="landingpage.html">Home</a>
        <a href="cart.html" class="active">Cart</a>
      </nav>
    </div>
  </header>

  <!-- Tab Navigation -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="showTab('cart')">Keranjang Belanja</button>
    <button class="tab-btn" onclick="showTab('history')">Histori Transaksi</button>
  </div>

  <!-- Cart Tab -->
  <div id="cart-tab" class="tab-content active">
    <main class="cart-main">
      <h1>Keranjang Belanja</h1>
      <div id="cartItems" class="cart-items"></div>

      <div class="payment-section">
        <h2>Pilih Metode Pembayaran</h2>
        <select id="payment-method" onchange="showPaymentDetail()">
          <option value="">-- Pilih metode --</option>
          <option value="qris">QRIS</option>
          <option value="ewallet">E-Wallet</option>
          <option value="bank">Transfer Bank</option>
        </select>

        <div id="payment-detail" class="payment-detail"></div>
      </div>

      <div class="cart-summary" style="display: none;">
        <h2>Ringkasan Pembayaran</h2>
        <div class="summary-row">
          <span>Harga Produk</span>
          <span id="productPrice">IDR 0</span>
        </div>
        <div class="summary-row">
          <span>Biaya Autentikasi</span>
          <span id="authFee">IDR 30,000</span>
        </div>
        <div class="summary-row">
          <span>Biaya Admin</span>
          <span id="processingFee">IDR 10,000</span>
        </div>
        <div class="summary-row">
          <span>Biaya Pengiriman</span>
          <span id="shippingFee">IDR 25,000</span>
        </div>
        <div class="summary-row total">
          <span>Total Pembayaran</span>
          <span id="totalPrice">IDR 0</span>
        </div>
        <button onclick="checkout()" class="checkout-btn" id="checkoutBtn">Proses Pembayaran</button>
        
        <div id="qr-section" style="display: none;">
          <h3>Scan QR Code untuk menyelesaikan pembayaran</h3>
          <img id="qr-image" src="" alt="QR Code Pembayaran" />
          <div id="payment-status" class="payment-status pending" style="display: none;">
            <div id="status-text">Menunggu pembayaran...</div>
            <div style="margin-top: 10px;">
              <button onclick="simulatePayment(true)" style="margin-right: 10px; padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Simulasi Berhasil</button>
              <button onclick="simulatePayment(false)" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Simulasi Gagal</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- History Tab -->
  <div id="history-tab" class="tab-content">
    <div class="history-container">
      <main class="history-main">
        <h1>Histori Transaksi</h1>
        <div id="transactionHistory"></div>
      </main>
    </div>
  </div>

  <script>
    let selectedPaymentDetail = null;
    let currentTransactionId = null;

    // Initialize sample cart data if localStorage is empty
  

    function formatPrice(price) {
      return 'IDR ' + price.toLocaleString('id-ID');
    }

    function generateTransactionId() {
      const timestamp = Date.now();
      const random = Math.random().toString(36).substr(2, 5).toUpperCase();
      return `WSK-${timestamp.toString().slice(-6)}-${random}`;
    }

    function loadCart() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const cartContainer = document.getElementById("cartItems");
      const totalPriceEl = document.getElementById("totalPrice");
      const productPriceEl = document.getElementById("productPrice");
      const cartSummary = document.querySelector(".cart-summary");

      cartContainer.innerHTML = "";
      let productTotal = 0;

      if (cart.length === 0) {
        cartContainer.innerHTML = "<p class='empty'>Keranjang masih kosong. <br><small>Data sampel telah ditambahkan untuk demo.</small></p>";
        cartSummary.style.display = "none";
        initializeSampleData();
        setTimeout(loadCart, 100);
        return;
      }

      cartSummary.style.display = "block";

      cart.forEach((item, index) => {
        productTotal += item.price * item.quantity;

        const itemHTML = `
          <div class="cart-item">
            <img src="${item.image}" alt="${item.name}" />
            <div class="item-details">
              <h3>${item.name}</h3>
              <p>Ukuran: <strong>${item.selectedSize}</strong></p>
              <p>Harga per item: ${formatPrice(item.price)}</p>
              <p>Jumlah: ${item.quantity}</p>
              <p>Subtotal: <strong>${formatPrice(item.price * item.quantity)}</strong></p>
            </div>
            <button onclick="removeItem(${index})" class="remove-btn">Hapus</button>
          </div>
        `;

        cartContainer.innerHTML += itemHTML;
      });

      const authFee = 30000;
      const processingFee = 10000;
      const shippingFee = 25000;
      const total = productTotal + authFee + processingFee + shippingFee;

      productPriceEl.textContent = formatPrice(productTotal);
      totalPriceEl.textContent = formatPrice(total);
      document.getElementById("authFee").textContent = formatPrice(authFee);
      document.getElementById("processingFee").textContent = formatPrice(processingFee);
      document.getElementById("shippingFee").textContent = formatPrice(shippingFee);
    }

    function removeItem(index) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      loadCart();
    }

    function showPaymentDetail() {
      const method = document.getElementById("payment-method").value;
      const detail = document.getElementById("payment-detail");
      selectedPaymentDetail = null;

      if (method === "qris") {
        detail.innerHTML = `
          <h3>Pembayaran QRIS</h3>
          <img src="https://via.placeholder.com/180x180/2c3e50/ffffff?text=QRIS+Code" class="qris-img" alt="QRIS">
          <p style="text-align: center; margin-top: 10px;">Scan QR code ini melalui aplikasi e-wallet Anda</p>
        `;
        selectedPaymentDetail = "QRIS";
      } else if (method === "ewallet") {
        detail.innerHTML = `
          <h3>Pembayaran E-Wallet</h3>
          <div class="wallet-logos">
            <div class="wallet" data-wallet="OVO">
              <img src="img/logoovo.png" alt="OVO">
              <span>0812-3456-7890 (OVO)</span>
            </div>
            <div class="wallet" data-wallet="GoPay">
              <img src="img/logogopay.jpg" alt="GoPay">
              <span>0813-2345-6789 (GoPay)</span>
            </div>
            <div class="wallet" data-wallet="DANA">
              <img src="img/logodana.png" alt="DANA">
              <span>0857-1234-5678 (DANA)</span>
            </div>
            <div class="wallet" data-wallet="ShopeePay">
              <img src="img/logoshopeepay.png" alt="ShopeePay">
              <span>0857-9876-5432 (ShopeePay)</span>
            </div>
          </div>
        `;
        setTimeout(() => makeSelectable(".wallet-logos", ".wallet"), 0);
      } else if (method === "bank") {
        detail.innerHTML = `
          <h3>Transfer Bank</h3>
          <div class="bank-logos">
            <div class="bank" data-bank="BCA">
              <img src="img/logobca.jpg" alt="BCA">
              <span>1234567890 a.n. WSKICKS (BCA)</span>
            </div>
            <div class="bank" data-bank="BNI">
              <img src="img/logobni.png" alt="BNI">
              <span>9876543210 a.n. WSKICKS (BNI)</span>
            </div>
            <div class="bank" data-bank="Mandiri">
              <img src="img/logomandiri.png" alt="Mandiri">
              <span>1122334455 a.n. WSKICKS (Mandiri)</span>
            </div>
          </div>
        `;
        setTimeout(() => makeSelectable(".bank-logos", ".bank"), 0);
      } else {
        detail.innerHTML = "";
      }
    }

    function makeSelectable(containerSelector, itemSelector) {
      const container = document.querySelector(containerSelector);
      if (!container) return;

      const items = container.querySelectorAll(itemSelector);
      items.forEach(item => {
        item.addEventListener("click", () => {
          items.forEach(el => el.classList.remove("selected-option"));
          item.classList.add("selected-option");
          
          const walletData = item.getAttribute('data-wallet');
          const bankData = item.getAttribute('data-bank');
          selectedPaymentDetail = walletData || bankData || item.innerText.trim();
        });
      });
    }

    function checkout() {
      const method = document.getElementById("payment-method").value;
      if (!method) {
        alert("Silakan pilih metode pembayaran terlebih dahulu!");
        return;
      }

      if ((method === "ewallet" || method === "bank") && !selectedPaymentDetail) {
        alert("Silakan pilih detail pembayaran terlebih dahulu!");
        return;
      }

      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      if (cart.length === 0) {
        alert("Keranjang kosong!");
        return;
      }

      const totalText = document.getElementById("totalPrice").textContent;
      const totalValue = parseInt(totalText.replace(/[^\d]/g, ""));
      
      currentTransactionId = generateTransactionId();
      
      const paymentInfo = `WSKICKS Payment\nTransaction: ${currentTransactionId}\nMethod: ${selectedPaymentDetail || method.toUpperCase()}\nTotal: ${formatPrice(totalValue)}`;
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(paymentInfo)}`;

      document.getElementById("qr-image").src = qrUrl;
      document.getElementById("qr-section").style.display = "block";
      document.getElementById("payment-status").style.display = "block";
      document.getElementById("checkoutBtn").disabled = true;
      document.getElementById("checkoutBtn").textContent = "Menunggu Pembayaran...";

      // Create pending transaction
      createTransaction(currentTransactionId, cart, method, selectedPaymentDetail, totalValue, 'pending');
    }

    function simulatePayment(success) {
      const statusEl = document.getElementById("payment-status");
      const statusText = document.getElementById("status-text");
      const checkoutBtn = document.getElementById("checkoutBtn");

      if (success) {
        statusEl.className = "payment-status success";
        statusText.textContent = "Pembayaran berhasil! Terima kasih atas pembelian Anda.";
        
        // Update transaction status
        updateTransactionStatus(currentTransactionId, 'success');
        
        // Clear cart after successful payment
        setTimeout(() => {
          localStorage.setItem("cart", JSON.stringify([]));
          loadCart();
          document.getElementById("qr-section").style.display = "none";
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = "Proses Pembayaran";
          document.getElementById("payment-method").value = "";
          document.getElementById("payment-detail").innerHTML = "";
          selectedPaymentDetail = null;
          alert("Pembayaran berhasil! Keranjang telah dikosongkan.");
        }, 2000);
      } else {
        statusEl.className = "payment-status failed";
        statusText.textContent = "Pembayaran gagal! Silakan coba lagi.";
        
        // Update transaction status
        updateTransactionStatus(currentTransactionId, 'failed');
        
        setTimeout(() => {
          document.getElementById("qr-section").style.display = "none";
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = "Proses Pembayaran";
        }, 2000);
      }
    }

    function createTransaction(transactionId, cart, method, paymentDetail, total, status) {
      const transactions = JSON.parse(localStorage.getItem("transactions")) || [];
      
      const transaction = {
        id: transactionId,
        date: new Date().toISOString(),
        items: [...cart],
        paymentMethod: method,
        paymentDetail: paymentDetail,
        total: total,
        status: status
      };
      
      transactions.unshift(transaction);
      localStorage.setItem("transactions", JSON.stringify(transactions));
      
      // Refresh history if currently viewing
      if (document.getElementById("history-tab").classList.contains("active")) {
        loadTransactionHistory();
      }
    }

    function updateTransactionStatus(transactionId, newStatus) {
      const transactions = JSON.parse(localStorage.getItem("transactions")) || [];
      const transactionIndex = transactions.findIndex(t => t.id === transactionId);
      
      if (transactionIndex !== -1) {
        transactions[transactionIndex].status = newStatus;
        localStorage.setItem("transactions", JSON.stringify(transactions));
        
        // Refresh history if currently viewing
        if (document.getElementById("history-tab").classList.contains("active")) {
          loadTransactionHistory();
        }
      }
    }

    function loadTransactionHistory() {
      const transactions = JSON.parse(localStorage.getItem("transactions")) || [];
      const historyContainer = document.getElementById("transactionHistory");
      
      if (transactions.length === 0) {
        historyContainer.innerHTML = "<p class='empty'>Belum ada transaksi yang tercatat.</p>";
        return;
      }

      let historyHTML = "";
      
      transactions.forEach(transaction => {
        const date = new Date(transaction.date);
        const formattedDate = date.toLocaleDateString('id-ID', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const statusClass = `status-${transaction.status}`;
        const statusText = {
          'pending': 'Menunggu',
          'success': 'Berhasil',
          'failed': 'Gagal'
        }[transaction.status];

        const itemsList = transaction.items.map(item => 
          `${item.name} (Size: ${item.selectedSize}) x${item.quantity}`
        ).join(', ');

        historyHTML += `
          <div class="transaction-item">
            <div class="transaction-header">
              <div>
                <div class="transaction-id">ID: ${transaction.id}</div>
                <div class="transaction-date">${formattedDate}</div>
              </div>
              <div class="transaction-status ${statusClass}">${statusText}</div>
            </div>
            <div class="transaction-details">
              <div class="transaction-info">
                <strong>Metode Pembayaran:</strong><br>
                ${transaction.paymentMethod.toUpperCase()} - ${transaction.paymentDetail || 'N/A'}
              </div>
              <div class="transaction-info">
                <strong>Total Pembayaran:</strong><br>
                ${formatPrice(transaction.total)}
              </div>
            </div>
            <div class="transaction-items">
              <h4>Item yang dibeli:</h4>
              <div class="transaction-item-list">${itemsList}</div>
            </div>
          </div>
        `;
      });
      
      historyContainer.innerHTML = historyHTML;
    }

    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabName + '-tab').classList.add('active');
      
      // Add active class to clicked tab button
      event.target.classList.add('active');
      
      if (tabName === 'history') {
        loadTransactionHistory();
      }
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      initializeSampleData();
      loadCart();
    });

    // Load cart when page loads
    loadCart();
  </script>
</body>
</html>